---
title: React èˆ‡å–®å‘è³‡æ–™æµ
tags: ['React', 'Virtual DOM', 'State Management']
sidebar_label: React èˆ‡å–®å‘è³‡æ–™æµ
sidebar_position: 1
---

## å‰è¨€

<aside>
ğŸ’¡ çœ‹å®Œé€™ç¯‡æ–‡ç« ä½ æœƒçŸ¥é“ï¼š
 1. ä»€éº¼æ˜¯ Virtual DOMï¼Ÿ
 2 çµ„æˆ Virtual DOMçš„æœ€å°å–®ä½ï¼šcreateElement

</aside>

## React èˆ‡ ç„¡å‰ç«¯æ¡†æ¶çš„å·®åˆ¥ï¼šVirtual DOM

### 1. **è¼ƒå¥½ç¶­è­·çš„ç¨‹å¼ç¢¼ï¼š**

<iframe
  height="300"
  width="100%"
  scrolling="no"
  title="DOM Example"
  src="https://codepen.io/Chious/embed/ZEZwgLj?default-tab=html%2Cresult"
  frameborder="no"
  loading="lazy"
  allowtransparency="true"
  allowfullscreen="true"
>
  See the Pen <a href="https://codepen.io/Chious/pen/ZEZwgLj">DOM Example</a> by
  Chiou Jia Sheng (<a href="https://codepen.io/Chious">@Chious</a>) on{' '}
  <a href="https://codepen.io">CodePen</a>.
</iframe>

å¦‚æœä½¿ç”¨å‚³çµ±çš„ Javascript ä¾†ç‚ºç¶­è­· DOMï¼Œé€™æ˜¯ä¸€ä»¶å¾ˆéº»ç…©çš„äº‹æƒ…ï¼š

- ç”¢ç”Ÿä¸€å€‹åˆå§‹çš„ `<ul/>` ç‰©ä»¶ã€‚
- ç•¶æŒ‰éˆ•è¢«é»æ“Šæ™‚æ“·å–ä½¿ç”¨è€…è¼¸å…¥çš„è³‡è¨Šã€‚
- ç”¢ç”Ÿä¸€å€‹æ–°çš„`<li/>`ç‰©ä»¶ï¼Œä¸¦ä¸”è³¦äºˆ idã€å…§å®¹ã€‚

Virtual DOM ç°¡åŒ–æ•´å€‹æµç¨‹ã€‚

### 2. **åªå°å¿…è¦é‡ç¹ªçš„éƒ¨åˆ†é€²è¡Œé‡æ§‹ï¼š**

ç•¶ DOM å…ƒç´ é€²è¡Œè®Šæ›´æ™‚ï¼ŒVirtual DOM æœƒæ¯”è¼ƒä¸Šä¸€æ¬¡çš„ç¯€é»ï¼Œä¸¦å°å°å°çš„æ‰€éœ€é€²è¡Œé‡ç¹ªã€‚æƒ³åƒä»Šå¤©æœ‰å€‹ `Counter` çš„ç‰©ä»¶ï¼Œç•¶é»æ“ŠæŒ‰éˆ•å¾Œæœƒæ›´æ–°è¨ˆæ•¸å™¨çš„æ•¸é‡ï¼š

```jsx
const virtualDOM = {
  type: 'div',
  props: {
    children: [
      {
        type: 'p',
        props: {
          children: ['ç›®å‰è¨ˆæ•¸ï¼š0'],
        },
      },
      {
        type: 'button',
        props: {
          onClick: () => setCount(count + 1),
          children: ['é»æˆ‘å¢åŠ '],
        },
      },
    ],
  },
};
```

ç„¶è€Œç•¶æŒ‰éˆ•è¢«é»æ“Šå¾Œï¼Œè¨ˆæ•¸å™¨çš„æ•¸å­—è¢«è®Šæ›´ï¼ŒReact ç´€éŒ„äº†æ–°çš„è³‡æ–™å°æ‡‰é—œä¿‚ï¼ˆè€ŒéçœŸå¯¦çš„ DOM å…ƒç´ ï¼‰ï¼Œä¸¦ç”¢ç”Ÿäº†æ–°çš„ virtaulDOMï¼š

```jsx
const newVirtualDOM = {
  type: 'div',
  props: {
    children: [
      {
        type: 'p',
        props: {
          children: ['ç›®å‰è¨ˆæ•¸ï¼š1'],
        },
      },
      {
        type: 'button',
        props: {
          onClick: () => setCount(count + 1),
          children: ['é»æˆ‘å¢åŠ '],
        },
      },
    ],
  },
};
```

é€é React çš„æ¼”ç®—æ³•å»æ¯”è¼ƒæ–°/èˆŠçš„çµæ§‹çš„å·®ç•°ï¼Œæˆ‘å€‘ç™¼ç¾åƒ…æœ‰ `<p/>` çš„å…§å®¹éœ€è¦é‡ç¹ªï¼ŒReact æœƒæ ¹æ“šæœ€å°çš„ DOM æ“ä½œç¯„åœï¼Œå»è¿”å›æ–°çš„çœŸå¯¦ DOM å…ƒç´ ç‰©ä»¶ï¼š

```html
<div>
  <p>ç›®å‰è¨ˆæ•¸ï¼š1</p>
  <button>é»æˆ‘å¢åŠ </button>
</div>
```

è‹¥æ“ä½œ DOM å…ƒç´ ï¼Œå¯èƒ½æœƒé‡ç½®æ•´å€‹ç‰©ä»¶ä¸¦é€²è¡Œç•«é¢é‡ç¹ªï¼Œç›¸è¼ƒæ–¼ Javascript çš„è¨ˆç®—æ˜¯ä¸€ä»¶æ˜‚è²´çš„äº‹æƒ…ã€‚ï¼ˆé€™é‚Šè¼ƒç‚ºæŠ½è±¡ï¼Œæš«æ™‚åƒè€ƒç¶²è·¯ä¸Šçš„[èªªæ³•](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/47)ï¼‰ã€‚

è¨»ï¼šåœ¨ React ç•¶ä¸­ï¼Œç•«é¢ç¹ªè£½åˆ†ç‚ºå…©å€‹æµç¨‹ï¼š

- Reconcilerï¼šè² è²¬å®šç¾©ã€ç®¡ç†ç•«é¢çµæ§‹çš„æè¿°ï¼ˆå¦‚ä¸Šé¢çš„ `newVirtualDOM`ï¼‰ã€‚
- Rendererï¼šæ ¹æ“š Reconciler çš„å®šç¾©ï¼ŒåŒæ™‚æœƒæ¯”è¼ƒæ–°èˆŠçš„å·®ç•°ï¼Œä¸¦åœ¨ `react-dom` é€™å€‹å®¹å™¨ä¸­ç¹ªè£½çœŸå¯¦çš„ DOM å…ƒç´ ã€‚

## React DOM çš„å®¹å™¨ï¼šRoot

<aside>
ğŸ’¡ äº†è§£Virtual DOM çš„æ©Ÿåˆ¶å¾Œï¼Œåœ¨å°ˆæ¡ˆä¸­åˆæ˜¯åœ¨å“ªè™•å¹«æˆ‘å€‘æŒç®¡å°ˆæ¡ˆçš„å‘¢ï¼Ÿ

</aside>

è‹¥ä½¿ç”¨ `create-react-app` å»ºç«‹ä¸€å€‹å°ˆæ¡ˆï¼Œä½ å¯ä»¥åœ¨è³‡æ–™å¤¾ä¸­æ‰¾åˆ° `index.html`ï¼Œé•·ç›¸å¦‚ä¸‹ï¼š

```jsx
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>React + TypeScript + Replit</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/index.jsx"></script>
</html>
```

åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¹Ÿæœƒç™¼ç¾`index.js`ï¼š

```jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

æƒ³åƒç¶²é åœ¨å»ºæ§‹çš„éç¨‹ä¸­ï¼Œæˆ‘å€‘æœƒé€é `ReactDOM` é€™å€‹ä»£ç†äººï¼Œä¾†å¹«æˆ‘å€‘æ±ºå®šè©²ç¹ªè£½ä»€éº¼ç•«é¢ã€‚

## ä»€éº¼æ˜¯[React Element](https://react.dev/reference/react/createElement)

<aside>
ğŸ’¡ æ¥ä¸‹ä¾†è¦ä»‹ç´¹çµ„æˆ Virtual DOM æœ€å°çš„å–®ä½ï¼šReact Element

</aside>

åœ¨ React ç•¶ä¸­ï¼Œæˆ‘å€‘å¸¸ä»¥ Self Closing Tag å‘¼å«ä¸€å€‹ç‰©ä»¶ï¼ˆä¾‹å¦‚ï¼š `<Greeting/>`ï¼‰ï¼Œäº‹å¯¦ä¸Šåœ¨ç·¨è­¯æ™‚å‘¼å«äº† `React.createElement()` é€™å€‹æ–¹æ³•å»å»ºç«‹ virtaul DOM çš„ç¯€é»ï¼š

```jsx
function Greeting({ name }) {
  return createElement(
    'h1', // HTMLæ¨™ç±¤
    { className: 'greeting' }, //å±¬æ€§
    'Hello' // å­å…ƒç´ 
  );
}
```

è€Œé€™äº›å¾®å°çš„è§£é»æ§‹æˆäº†ä¸€å€‹é é¢çš„æ¨£å­ï¼ŒåŒæ™‚åœ¨ Component ä¸Šèƒ½å¤ æè¿°å„å¼çš„æ¨™ç±¤ï¼š

```jsx
function App() {
  return (
    <div>
      <Greeting name="Amy" />
      <Greeting name="Sam" />
      <Greeting name="Johnny" />
    </div>
  );
}
```

ç„¶è€Œæˆ‘å€‘çš„ç€è¦½å™¨æˆ–ç·¨è­¯å™¨ä¸¦ä¸çœŸçš„èªè­˜ `<Greeting/>` é€™å€‹æ¨™ç±¤ï¼Œè€Œæ˜¯åœ¨ build time æ™‚ï¼Œé€éè½‰è­¯å™¨ï¼ˆå¦‚ï¼šBabelï¼‰ï¼Œå°‡ `<Greeting/>` è½‰è­¯æˆï¼š

```jsx
 createElement(â€™hiâ€™, {className: â€œgreetingâ€}, "Hello")
```

ä¸¦åœ¨ç€è¦½å™¨é‹è¡Œæ™‚ï¼ˆrun timeï¼‰é‹ä½œé€™äº›æ–¹æ³•ï¼š

```jsx
 createElement(â€™hiâ€™, {className: â€œgreetingâ€}, "Hello")
 createElement(â€™hiâ€™, {className: â€œgreetingâ€}, "Hello")
 createElement(â€™hiâ€™, {className: â€œgreetingâ€}, "Hello")

  ...ï¼ˆå‡å¦‚æœ‰å¾ˆå¤šç¯€é»çš„è©±ï¼‰
```

## åƒè€ƒè³‡æ–™

1. **React æ€ç¶­é€²åŒ–ï¼šä¸€æ¬¡æ‰“ç ´å¸¸è¦‹çš„è§€å¿µèª¤è§£ï¼Œèºå‡å°ˆæ¥­å‰ç«¯é–‹ç™¼è€…**
